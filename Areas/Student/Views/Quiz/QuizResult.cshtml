@model TadrousManassa.Areas.Student.Models.QuizResultDTO

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold text-primary">🎉Quiz Result 🎉</h2>

        @if (Model.CurrentScore is not null || Model.BestScore is not null)
        {
            @if (Model.CurrentScore is not null)
            {
                <h4 class="score-box bg-info text-white p-3 rounded d-inline-block mx-2">
                    Current Score: <span class="fw-bold">@Model.CurrentScore</span> / @Model.TotalScore
                </h4>
            }

            @if (Model.BestScore is not null)
            {
                <h4 class="score-box bg-success text-white p-3 rounded d-inline-block mx-2">
                    Best Score: <span class="fw-bold">@Model.BestScore</span> / @Model.TotalScore
                </h4>
            }
            // Display IsSuccess
            if (Model.IsSuccess == true)
            {
                <h4 class="score-box bg-success text-white p-3 rounded d-inline-block mx-2">
                    State: <span class="fw-bold">Successful ✅</span>
                </h4>
            }
            else
            {
                <h4 class="score-box bg-danger text-white p-3 rounded d-inline-block mx-2">
                    State: <span class="fw-bold">Failed ❌</span>
                </h4>
            }
        }
        
    </div>

    <div class="mt-4">
        @foreach (var question in Model.Questions)
        {
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        @question.QuestionText ❓
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-column gap-2">
                        @foreach (var choice in question.Choices)
                        {
                            var isSelected = question.SelectedChoiceId == choice.ChoiceId;
                            var isCorrectAnswer = choice.IsCorrect;
                            string btnClass = ""; // default

                            if (isSelected && question.IsCorrect == true)
                            {
                                btnClass = "btn-success"; // correct selection
                            }
                            else if (isSelected && question.IsCorrect == false)
                            {
                                btnClass = "btn-danger"; // wrong selection
                            }
                            else if (!isSelected && isCorrectAnswer && question.IsCorrect == false && Model.RemainingAttempts == 0)
                            {
                                btnClass = "btn-success"; // show correct answer if wrong
                            }

                            <label class="@btnClass">
                                <input type="radio" disabled @(isSelected ? "checked" : "") />
                                <span class="custom-radio"></span>
                                @choice.ChoiceText
                            </label>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="text-center mt-4">
        <a href="@Url.Action("Index", "Home")" class="btn btn-primary me-2">
            <i class="fas fa-home me-2"></i> العودة للصفحة الرئيسية
        </a>

        @if (Model.RemainingAttempts > 0)
        {
            <form asp-controller="Quiz" asp-action="OnPostRetake" method="post" class="d-inline">
                <input type="hidden" name="qId" value="@Model.QuizId" />
                <button type="submit" class="btn btn-warning">
                    🔄 إعادة المحاولة
                </button>
            </form>
        }

        @if (Model.IsNextVideoExists)
        {
            <form asp-controller="Lecture" asp-action="LectureDetails" method="get" class="d-inline">
                <input type="hidden" name="lectureId" value="@Model.LectureId" />
                <input type="hidden" name="order" value="@Model.NextVideoOrder" />
                <button type="submit" class="btn btn-success">
                    ▶ الانتقال للفيديو التالي
                </button>
            </form>
        }
    </div>
</div>
